{
  "hash": "0d9732644f1c01b6e161b3372ea0013f",
  "result": {
    "markdown": "---\ntitle: \"Post-5\"\nsubtitle: \"Merging Data Sets\"\nauthor: \"\"\ndate: \"2024-04-10\"\ndate-modified: \"2024-04-10\"\ndraft: FALSE\n---\n\n## Cleaning Second Data Set\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(pROC)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nType 'citation(\"pROC\")' for a citation.\n\nAttaching package: 'pROC'\n\nThe following objects are masked from 'package:stats':\n\n    cov, smooth, var\n```\n:::\n\n```{.r .cell-code}\niowa_data <- read_csv(here::here(\"dataset\", \"Iowa_Probation_Recidivism_Status_20240403.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 73076 Columns: 29\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (21): Race, Sex, Supervising Region Name, Work Unit Name, Jurisdiction, ...\ndbl  (6): Age, Cohort Fiscal Year, Report Fiscal Year, Time Served (Months),...\nlgl  (2): Under 18, Reincarcerated\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\niowa_data_clean <- iowa_data %>%\n  select(sex = Sex, race = Race, age = Age, reincarcerated = Reincarcerated)\nwrite_csv(iowa_data_clean, file = here::here(\"dataset\", \"iowa-data-clean.csv\"))\nnew_compas <- read_csv(here::here(\"dataset\", \"compas-scores-two-years-violent.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNew names:\n• `decile_score` -> `decile_score...12`\n• `priors_count` -> `priors_count...15`\n• `decile_score` -> `decile_score...40`\n• `priors_count` -> `priors_count...49`\n• `two_year_recid` -> `two_year_recid...53`\n• `two_year_recid` -> `two_year_recid...54`\n• `` -> `...56`\n• `` -> `...57`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat <- vroom(...)\n  problems(dat)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 4743 Columns: 57\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (33): name, first, last, compas_screening_date, sex, dob, age_cat, race,...\ndbl (20): id, age, juv_fel_count, decile_score...12, juv_misd_count, juv_oth...\nlgl  (4): violent_recid, reincarcerated, ...56, ...57\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nnew_compas_clean <- new_compas %>%\n  select(sex, age, race, reincarcerated)\nwrite_csv(new_compas_clean, file = here::here(\"dataset\", \"new-compas-clean.csv\"))\n```\n:::\n\n\n## Merging Data Set\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_compas_clean <- new_compas_clean %>% mutate(state = \"Florida\")\niowa_data_clean <- iowa_data_clean %>% mutate(state = \"Iowa\")\ncombined_data <- bind_rows(new_compas_clean, iowa_data_clean)\nwrite_csv(combined_data, file = here::here(\"dataset\", \"combined-data.csv\"))\nsummary(combined_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     sex                 age            race           reincarcerated \n Length:77819       Min.   :16.10   Length:77819       Mode :logical  \n Class :character   1st Qu.:23.80   Class :character   FALSE:68007    \n Mode  :character   Median :30.80   Mode  :character   TRUE :9812     \n                    Mean   :33.48                                     \n                    3rd Qu.:40.60                                     \n                    Max.   :93.10                                     \n                    NA's   :1                                         \n    state          \n Length:77819      \n Class :character  \n Mode  :character  \n                   \n                   \n                   \n                   \n```\n:::\n:::\n\n\n## Further Analysis\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(combined_data, aes(x = age)) + geom_histogram(binwidth = 5, fill = \"blue\", color = \"black\") +\n  ggtitle(\"Age Distribution\") + xlab(\"Age\") + ylab(\"Frequency\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 row containing non-finite outside the scale range\n(`stat_bin()`).\n```\n:::\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(combined_data, aes(x = sex, fill = reincarcerated)) + geom_bar(position = \"fill\") +\n  ggtitle(\"Reincarceration Rate by Sex\") + ylab(\"Proportion\")\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(combined_data, aes(x = race, fill = reincarcerated)) + geom_bar(position = \"fill\") +\n  ggtitle(\"Reincarceration Rate by Race\") + ylab(\"Proportion\") + theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n\n```{.r .cell-code}\nchisq.test(table(combined_data$sex, combined_data$reincarcerated))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in chisq.test(table(combined_data$sex, combined_data$reincarcerated)):\nChi-squared approximation may be incorrect\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  table(combined_data$sex, combined_data$reincarcerated)\nX-squared = 631.99, df = 2, p-value < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nchisq.test(table(combined_data$race, combined_data$reincarcerated))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  table(combined_data$race, combined_data$reincarcerated)\nX-squared = 462.8, df = 5, p-value < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\ncombined_data$sex <- factor(combined_data$sex)\ncombined_data$sex <- relevel(combined_data$sex, ref = \"Male\")\ncombined_data$race <- factor(combined_data$race)\ncombined_data$race <- relevel(combined_data$race, ref = \"White\")\ncombined_data$state <- factor(combined_data$state)\ncombined_data$state <- relevel(combined_data$state, ref = \"Iowa\")\nmodel <- glm(reincarcerated ~ sex + age + race + state, data = combined_data, family = \"binomial\")\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = reincarcerated ~ sex + age + race + state, family = \"binomial\", \n    data = combined_data)\n\nCoefficients:\n                                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                          -1.4048432  0.0351159 -40.006  < 2e-16 ***\nsexFemale                            -0.6964190  0.0282812 -24.625  < 2e-16 ***\nsexUnknown                           -9.1252647 49.1564263  -0.186 0.852729    \nage                                  -0.0139443  0.0009744 -14.311  < 2e-16 ***\nraceAmerican Indian or Alaska Native  0.7433721  0.0789382   9.417  < 2e-16 ***\nraceAsian or Pacific Islander        -0.5698694  0.1073058  -5.311 1.09e-07 ***\nraceBlack                             0.3088877  0.0277710  11.123  < 2e-16 ***\nraceHispanic                         -0.3366326  0.0474185  -7.099 1.26e-12 ***\nraceOther                            -0.6211446  0.1608214  -3.862 0.000112 ***\nstateFlorida                          0.5956697  0.0399722  14.902  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 58968  on 77817  degrees of freedom\nResidual deviance: 57459  on 77808  degrees of freedom\n  (1 observation deleted due to missingness)\nAIC: 57479\n\nNumber of Fisher Scoring iterations: 10\n```\n:::\n\n```{.r .cell-code}\n#Effect of Age on Probability of Reincarceration by Race\n#Male\nmodel_without_state <- glm(reincarcerated ~ sex + age + race, family = \"binomial\", data = combined_data)\nmin_age <- min(combined_data$age, na.rm = TRUE)\nmax_age <- max(combined_data$age, na.rm = TRUE)\nnew_data <- expand.grid(\n  sex = factor(\"Male\", levels = levels(combined_data$sex)),\n  age = seq(min_age, max_age, length.out = 100),\n  race = levels(combined_data$race)\n)\n\nnew_data$probability <- predict(model_without_state, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = age, y = probability, color = race)) +\n  geom_line() +\n  labs(title = \"Effect of Age on Probability of Reincarceration by Race_Males\",\n       x = \"Age\",\n       y = \"Probability of Reincarceration\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#Female\nmin_age <- min(combined_data$age, na.rm = TRUE)\nmax_age <- max(combined_data$age, na.rm = TRUE)\nnew_data <- expand.grid(\n  sex = factor(\"Female\", levels = levels(combined_data$sex)),\n  age = seq(min_age, max_age, length.out = 100),\n  race = levels(combined_data$race)\n)\n\nnew_data$probability <- predict(model_without_state, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = age, y = probability, color = race)) +\n  geom_line() +\n  labs(title = \"Effect of Age on Probability of Reincarceration by Race_Males\",\n       x = \"Age\",\n       y = \"Probability of Reincarceration\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-5.png){width=672}\n:::\n\n```{.r .cell-code}\n#Probability of Reincarceration by Race\n#Male\nnew_data <- data.frame(\n  sex = factor(\"Male\", levels = levels(combined_data$sex)),\n  age = mean(combined_data$age, na.rm = TRUE),\n  race = levels(combined_data$race)\n)\n\nnew_data$probability <- predict(model_without_state, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = race, y = probability, fill = race)) +\n  geom_col() +\n  labs(title = \"Probability of Reincarceration by Race_Male\",\n       x = \"Race\",\n       y = \"Probability of Reincarceration\") +\n  theme_minimal()+\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-6.png){width=672}\n:::\n\n```{.r .cell-code}\n#Female\nnew_data <- data.frame(\n  sex = factor(\"Female\", levels = levels(combined_data$sex)),\n  age = mean(combined_data$age, na.rm = TRUE),\n  race = levels(combined_data$race)\n)\n\nnew_data$probability <- predict(model_without_state, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = race, y = probability, fill = race)) +\n  geom_col() +\n  labs(title = \"Probability of Reincarceration by Race_Female\",\n       x = \"Race\",\n       y = \"Probability of Reincarceration\") +\n  theme_minimal()+\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-3-7.png){width=672}\n:::\n:::\n\n\nFrom the Chi-squared test for sex and race with incarcerated, the results indicate statistically significant associations between both sex and race with reincarceration status in our combined dataset, as both p-values are well below the conventional alpha level of 0.05. The result from Chi-squared test for sex with incarcerated suggests that there is a significant association between an individual's sex and their likelihood of being reincarcerated. The data would likely show that one sex is more prone to reincarceration than the other. And the result from Chi-squared test for race with incarcerated indicates a significant association between an individual's race and their likelihood of being reincarcerated. Different races may have different reincarceration rates.\n\nThe logistic regression analysis on the dataset reveals significant insights into the factors influencing reincarceration rates. \"Male\", \"White\" and \"Iowa\" are the majority categories in sex, race, and state, and using them as the baseline would provide a point of comparison against the other categories, which can be quite informative, especially in highlighting differences or disproportionalities. The model highlights substantial sex-based differences in reincarceration odds, with females showing significantly lower odds compared to males. Age is another influential factor; younger individuals are more likely to be reincarcerated, underscoring the importance of targeted interventions for youth. Racial disparities are pronounced: American Indians or Alaska Natives exhibit higher reincarceration odds compared to Whites, while Asian or Pacific Islanders and Hispanics have lower odds. Blacks show slightly higher odds than Whites, highlighting nuanced differences among racial groups. Additionally, regional variations are evident, as individuals from Florida are significantly more likely to be reincarcerated than those from Iowa. The model's excellent fit, as indicated by AIC and changes in deviance, suggests that it effectively captures the underlying patterns in the data.\n\n## Code for Post 6\n\n## Continue Analysis on Combined Dataset \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(caret)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: lattice\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'caret'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:purrr':\n\n    lift\n```\n:::\n\n```{.r .cell-code}\npredicted_probabilities <- predict(model, newdata = combined_data, type = \"response\")\nroc_curve <- roc(response = combined_data$reincarcerated, predictor = predicted_probabilities)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting levels: control = FALSE, case = TRUE\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSetting direction: controls < cases\n```\n:::\n\n```{.r .cell-code}\nplot(roc_curve, main = \"ROC Curve\")\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nauc(roc_curve)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nArea under the curve: 0.6106\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Florida Model\ndata_florida <- filter(combined_data, state == \"Florida\")\nmodel_florida <- glm(reincarcerated ~ sex + age + race, data = data_florida, family = \"binomial\")\nsummary(model_florida)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = reincarcerated ~ sex + age + race, family = \"binomial\", \n    data = data_florida)\n\nCoefficients:\n                                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                          -0.127963   0.142675  -0.897    0.370    \nsexFemale                            -0.729570   0.103610  -7.041 1.90e-12 ***\nage                                  -0.038176   0.003547 -10.763  < 2e-16 ***\nraceAmerican Indian or Alaska Native  0.824563   0.641581   1.285    0.199    \nraceAsian or Pacific Islander         0.208098   0.476041   0.437    0.662    \nraceBlack                             0.495628   0.084139   5.891 3.85e-09 ***\nraceHispanic                         -0.220377   0.151102  -1.458    0.145    \nraceOther                            -0.108371   0.178700  -0.606    0.544    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 4872.7  on 4742  degrees of freedom\nResidual deviance: 4600.0  on 4735  degrees of freedom\nAIC: 4616\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\n#Effect of Age on Probability of Reincarceration in Florida by Race\n#Male\nnew_data <- expand.grid(\n  sex = factor(\"Male\", levels = levels(data_florida$sex)),\n  age = seq(min(data_florida$age), max(data_florida$age), length.out = 100),\n  race = levels(data_florida$race)\n)\n\nnew_data$probability <- predict(model_florida, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = age, y = probability, color = race)) +\n  geom_line() +\n  labs(title = \"Effect of Age on Probability of Reincarceration in Florida by Race_Male\",\n       x = \"Age\",\n       y = \"Probability of Reincarceration\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Female\nnew_data <- expand.grid(\n  sex = factor(\"Female\", levels = levels(data_florida$sex)),\n  age = seq(min(data_florida$age), max(data_florida$age), length.out = 100),\n  race = levels(data_florida$race)\n)\n\nnew_data$probability <- predict(model_florida, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = age, y = probability, color = race)) +\n  geom_line() +\n  labs(title = \"Effect of Age on Probability of Reincarceration in Florida by Race_Female\",\n       x = \"Age\",\n       y = \"Probability of Reincarceration\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#Probability of Reincarceration by Race in Florida\n#Male\nnew_data <- data.frame(\n  sex = factor(\"Male\", levels = levels(data_florida$sex)),\n  age = mean(data_florida$age),\n  race = levels(data_florida$race)\n)\n\nnew_data$probability <- predict(model_florida, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = race, y = probability, fill = race)) +\n  geom_col() +\n  labs(title = \"Probability of Reincarceration by Race in Florida_Male\",\n       x = \"Race\",\n       y = \"Probability of Reincarceration\") +\n  theme_minimal()+\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#Female\nnew_data <- data.frame(\n  sex = factor(\"Female\", levels = levels(data_florida$sex)),\n  age = mean(data_florida$age),\n  race = levels(data_florida$race)\n)\n\nnew_data$probability <- predict(model_florida, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = race, y = probability, fill = race)) +\n  geom_col() +\n  labs(title = \"Probability of Reincarceration by Race in Florida_Female\",\n       x = \"Race\",\n       y = \"Probability of Reincarceration\") +\n  theme_minimal()+\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#Iowa Model\ndata_iowa <- filter(combined_data, state == \"Iowa\")\nmodel_iowa <- glm(reincarcerated ~ sex + age + race, data = data_iowa, family = \"binomial\")\nsummary(model_iowa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = reincarcerated ~ sex + age + race, family = \"binomial\", \n    data = data_iowa)\n\nCoefficients:\n                                       Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                           -1.471445   0.036572 -40.234  < 2e-16 ***\nsexFemale                             -0.694748   0.029418 -23.616  < 2e-16 ***\nsexUnknown                            -0.176008 229.840258  -0.001    0.999    \nage                                   -0.011667   0.001014 -11.511  < 2e-16 ***\nraceAmerican Indian or Alaska Native   0.737312   0.079531   9.271  < 2e-16 ***\nraceAsian or Pacific Islander         -0.602408   0.110536  -5.450 5.04e-08 ***\nraceBlack                              0.282931   0.029869   9.473  < 2e-16 ***\nraceHispanic                          -0.330196   0.050146  -6.585 4.56e-11 ***\nraceOther                            -12.570764  65.143194  -0.193    0.847    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 53817  on 73074  degrees of freedom\nResidual deviance: 52757  on 73066  degrees of freedom\n  (1 observation deleted due to missingness)\nAIC: 52775\n\nNumber of Fisher Scoring iterations: 13\n```\n:::\n\n```{.r .cell-code}\n#Effect of Age on Probability of Reincarceration in Florida by Race\n#Male\nmin_age <- min(data_iowa$age, na.rm = TRUE)\nmax_age <- max(data_iowa$age, na.rm = TRUE)\n\nnew_data <- expand.grid(\n  sex = factor(\"Male\", levels = levels(data_iowa$sex)),\n  age = seq(min_age, max_age, length.out = 100),\n  race = factor(levels(data_iowa$race), levels = levels(data_iowa$race))\n)\n\nnew_data$probability <- predict(model_iowa, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = age, y = probability, color = race)) +\n  geom_line() +\n  labs(title = \"Effect of Age on Probability of Reincarceration in Florida by Race_Male\",\n       x = \"Age\",\n       y = \"Probability of Reincarceration\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n\n```{.r .cell-code}\n#Female\nmin_age <- min(data_iowa$age, na.rm = TRUE)\nmax_age <- max(data_iowa$age, na.rm = TRUE)\n\nnew_data <- expand.grid(\n  sex = factor(\"Female\", levels = levels(data_iowa$sex)),\n  age = seq(min_age, max_age, length.out = 100),\n  race = factor(levels(data_iowa$race), levels = levels(data_iowa$race))\n)\n\nnew_data$probability <- predict(model_iowa, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = age, y = probability, color = race)) +\n  geom_line() +\n  labs(title = \"Effect of Age on Probability of Reincarceration in Florida by Race_Female\",\n       x = \"Age\",\n       y = \"Probability of Reincarceration\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-6.png){width=672}\n:::\n\n```{.r .cell-code}\n#Probability of Reincarceration by Race in Iowa\n#Male\nnew_data <- data.frame(\n  sex = factor(\"Male\", levels = levels(data_iowa$sex)),\n  age = mean(data_iowa$age, na.rm = TRUE),\n  race = levels(data_iowa$race)\n)\n\nnew_data$probability <- predict(model_iowa, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = race, y = probability, fill = race)) +\n  geom_col() +\n  labs(title = \"Probability of Reincarceration by Race in Iowa_Male\",\n       x = \"Race\",\n       y = \"Probability of Reincarceration\") +\n  theme_minimal()+\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-7.png){width=672}\n:::\n\n```{.r .cell-code}\n#Female\nnew_data <- data.frame(\n  sex = factor(\"Female\", levels = levels(data_iowa$sex)),\n  age = mean(data_iowa$age, na.rm = TRUE),\n  race = levels(data_iowa$race)\n)\n\nnew_data$probability <- predict(model_iowa, newdata = new_data, type = \"response\")\n\nggplot(new_data, aes(x = race, y = probability, fill = race)) +\n  geom_col() +\n  labs(title = \"Probability of Reincarceration by Race in Iowa_Female\",\n       x = \"Race\",\n       y = \"Probability of Reincarceration\") +\n  theme_minimal()+\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-5-8.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nproportion_data <- combined_data %>%\n  group_by(state, race) %>%\n  summarise(Reoffence_Proportion = mean(reincarcerated, na.rm = TRUE)) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'state'. You can override using the\n`.groups` argument.\n```\n:::\n\n```{.r .cell-code}\n# Plot the proportions\nggplot(proportion_data, aes(x = race, y = Reoffence_Proportion, fill = race)) +\n  geom_bar(stat = \"identity\", position = position_dodge()) +\n  facet_wrap(~ state) +\n  labs(title = \"Proportion of Different Races Reoffended in Each State\",\n       x = \"Race\",\n       y = \"Proportion of Reoffence\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](post5_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::",
    "supporting": [
      "post5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}